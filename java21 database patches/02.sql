-- 02.sql --> Liên quan đến ORDER, STATUS, CUSTOMER
-- T03_ORDER, T04_PAYMENT_METHOD, T05_ORDER_STATUS, T11_CUSTOMER, 
-- T14_ORDER_DETAIL, T15_ORDER_STATUS_DETAIL
-- Thiếu bảng ??? BILL ???

-- USE java21_shopping; -- set database java21_shopping as default

-- disable foreign key check
SET FOREIGN_KEY_CHECKS = 0;
DROP TABLE IF EXISTS T11_CUSTOMER;
CREATE TABLE T11_CUSTOMER(
	C11_CUSTOMER_ID INT PRIMARY KEY,
	C11_CUSTOMER_NAME VARCHAR(100) NOT NULL,
	C11_CUSTOMER_EMAIL VARCHAR(100) NOT NULL,
	C11_EMPLOYEE_ADDRESS VARCHAR(100) NOT NULL,
	C11_EMPLOYEE_PHONE INT NOT NULL,
	C11_EMPLOYEE_USERNAME VARCHAR(50) NOT NULL,
	C11_EMPLOYEE_PASSWORD VARCHAR(50) NOT NULL,

	CONSTRAINT CHECK_EMPLOYEE_PHONE CHECK(C11_EMPLOYEE_PHONE = 10)
	-- CÓ THỂ TRÙNG TÊN KHÁCH HÀNG
    

);

DROP TABLE IF EXISTS T03_ORDER;
CREATE TABLE T03_ORDER(
	C03_ORDER_ID INT PRIMARY KEY,
	C03_ORDER_TIME DATETIME NOT NULL ,
	C03_DELIVERY_FEE FLOAT NOT NULL,
	C03_DELIVERY_ADDRESS VARCHAR(100) NOT NULL,
	C03_RECEIVER_PHONE INT NOT NULL,
	C03_TOTAL_OF_MONEY FLOAT NOT NULL,
	C03_PMETHOD_ID INT,
	C03_CUSTOMER_ID INT,

    CONSTRAINT CHECK_DELIVERY_FEE CHECK(C03_DELIVERY_FEE >= 0),
	CONSTRAINT CHECK_RECEIVER_PHONE CHECK(C03_RECEIVER_PHONE = 10),
	CONSTRAINT CHECK_TOTAL_OF_MONEY CHECK(C03_TOTAL_OF_MONEY >= 0),

	
	CONSTRAINT FK_ORDER_CUSTOMER FOREIGN KEY (C03_CUSTOMER_ID)
								REFERENCES T11_CUSTOMER(C11_CUSTOMER_ID)
);

DROP TABLE IF EXISTS T04_PAYMENT_METHOD;
CREATE TABLE T04_PAYMENT_METHOD(
	C04_PMETHOD_ID INT PRIMARY KEY,
	C04_PMETHOD_DESC VARCHAR(100)
);

DROP TABLE IF EXISTS T05_ORDER_STATUS;
CREATE TABLE T05_ORDER_STATUS(
	C05_ORDER_STATUS_ID INT PRIMARY KEY,
	C05_ORDER_STATUS_DESC VARCHAR(100) NOT NULL

);

DROP TABLE IF EXISTS T14_ORDER_DETAIL;
CREATE TABLE T14_ORDER_DETAIL(
	C14_ORDER_ID INT,
	C14_ITEM_DETAIL_ID INT,
	C14_AMOUNT INT,

	PRIMARY KEY(C14_ORDER_ID,C14_ITEM_DETAIL_ID),
    -- CONSTRAINT CHECK_AMOUNT_POSITIVE CHECK (C14_AMOUNT >= 0),

	CONSTRAINT FK_ORDER_DETAIL_ORDER FOREIGN KEY (C14_ORDER_ID)
									REFERENCES T03_ORDER(C03_ORDER_ID),
	CONSTRAINT FK_ORDER_DETAIL_ITEM_DETAIL FOREIGN KEY (C14_ITEM_DETAIL_ID)
											REFERENCES T12_ITEM_DETAIL(C12_ITEM_DETAIL_ID)
                                    
);

DROP TABLE IF EXISTS T15_ORDER_STATUS_DETAIL;
CREATE TABLE T15_ORDER_STATUS_DETAIL (
  C15_ORDER_ID INT,
  C15_ORDER_STATUS_ID INT,
  C15_EMPLOYEE_ID INT,
  C15_LAST_UPDATE DATETIME NOT NULL,

  PRIMARY KEY (C15_ORDER_ID, C15_ORDER_STATUS_ID),
  CONSTRAINT FK_OSD_ORDER FOREIGN KEY (C15_ORDER_ID) REFERENCES T03_ORDER(C03_ORDER_ID),
  CONSTRAINT FK_ORDER_STATUS FOREIGN KEY (C15_ORDER_STATUS_ID) REFERENCES T05_ORDER_STATUS(C05_ORDER_STATUS_ID),
  CONSTRAINT FK_OSD_EMPLOYEE FOREIGN KEY (C15_EMPLOYEE_ID) REFERENCES T07_EMPLOYEE(C07_EMPLOYEE_ID)
);
ALTER TABLE T03_ORDER
ADD CONSTRAINT FK_ORDER_PMETHOD FOREIGN KEY (C03_PMETHOD_ID)
								REFERENCES T04_PAYMENT_METHOD(C04_PMETHOD_ID);
SET FOREIGN_KEY_CHECKS = 1;

                                
