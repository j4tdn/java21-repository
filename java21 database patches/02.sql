-- 03.sql --> Lien quan den STATISTIC
-- T09_ITEM_STATISTIC, T10_REVENUE

USE java21_shopping;

CREATE TABLE T08_TITLE (
  C08_TITLE_ID INT PRIMARY KEY,
  C08_TITLE_NAME VARCHAR(30) NOT NULL
);

CREATE TABLE T07_EMPLOYEE (
  C07_EMPLOYEE_ID INT PRIMARY KEY,
  C07_EMPLOYEE_NAME VARCHAR(255) NOT NULL,
  C07_EMPLOYEE_ADDRESS VARCHAR(100) NOT NULL,
  C07_EMPLOYEE_PHONE VARCHAR(11) NOT NULL,
  C07_EMPLOYEE_EMAIL VARCHAR(50) NOT NULL,
  C07_EMPLOYEE_USERNAME VARCHAR(20) NOT NULL,
  C07_EMPLOYEE_PASSWORD VARCHAR(20) NOT NULL,
  C07_TITLE_ID INT,
  CONSTRAINT CHECK_EMPLOYEE_PHONE_LENGTH CHECK (LENGTH(C07_EMPLOYEE_PHONE) BETWEEN 10 AND 11 
                                                AND C07_EMPLOYEE_PHONE REGEXP '^[0-9]+&'),
  CONSTRAINT CHECK_C07_EMPLOYEE_PASSWORD CHECK (LENGTH(C07_EMPLOYEE_PASSWORD) >= 8
                                                AND C07_EMPLOYEE_PASSWORD REGEXP '[A-Z]'
                                                AND C07_EMPLOYEE_PASSWORD REGEXP '[@#$%^&*]'),
  CONSTRAINT FK_EMPLOYEE_TITLE FOREIGN KEY (C07_TITLE_ID) REFERENCES T08_TITLE(C08_TITLE_ID)										
);

ALTER TABLE t07_employee
MODIFY COLUMN C07_EMPLOYEE_PASSWORD VARCHAR(255) NOT NULL;

ALTER TABLE t07_employee
DROP CONSTRAINT CHECK_C07_EMPLOYEE_PASSWORD;

ALTER TABLE T07_EMPLOYEE 
DROP CONSTRAINT CHECK_EMPLOYEE_PHONE_LENGTH;

ALTER TABLE T07_EMPLOYEE
MODIFY COLUMN C07_TITLE_ID INT NOT NULL;

ALTER TABLE T07_EMPLOYEE
ADD CONSTRAINT UNQ_EMPLOYEE_USERNAME UNIQUE (C07_EMPLOYEE_USERNAME);

